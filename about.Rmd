---
title: "About"
author: "Jessica Edwards"
date: "2/27/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(janitor)
```
## Milestone 4 Update

I have found and cleaned data tables for more than twenty schools on Degrees Awarded by Program in 2018. These tables provide the racial and gender breakdowns within STEM degrees awarded at each school. The schools included are all eight Ivy Leagues as well as the following institutions: 

Boston University,
California Institute of Technology,
University of California, Berkeley,
Carnegie Mellon University,
Duke University,
Georgia Institute of Technology,
Harvey Mudd College,
Johns Hopkins University,
Massachusetts Institute of Technology,
Northwestern University,
Tufts University,
Vanderbilt University,
University of Virginia,
Washington University in St. Louis

## Summary and Goals

This project's goal is to analyze students studying STEM at the university level and to break down and compare racial and gender demographics between highly ranked institutions within the United States. This data is collected from the [American Society for Engineering Education (ASEE)](https://www.asee.org/). 

This investigation hopes to critique the current demographic breakdown of STEM fields and encourage higher institutions to think more about how they can help encourage underrepresented minorities to enter and remain interested in STEM fields. 

So far in my project, I have currently found and cleaned data tables on Degrees Awarded by Program in 2018. These tables provide the racial and gender breakdowns within STEM degrees awarded at each school. 

I would also like to analyze the number of students studying each field in total over a longer time span to see if the racial and gender breakdowns changes significantly over time. 

Additionally, there are tables on the ASEE website that break down each field based on how many students identify as male or female within each race which may be interesting to incorporate in my project. 

Finally, I may consider including data about K-12 STEM programs and career paths in my project in order to analyze if racial and gender breakdowns before and after college are similar.

#### Github Link: https://github.com/jessie9111/gov1005-final-project

## The Data

```{r ugrad_degrees function, echo=FALSE}

# Wrote a function to scrap all of the tables more efficiently. Function takes
# in a url and scrapes that page for tables using function in the rvest package.

ugrad_degrees_2018 <- function(url) {
  table <- read_html(url) %>% 
    html_nodes("table")

  # Used the rvest package to read the table with racial and gender breakdowns.
  # Removed the "Tot" column in the table and rows with NA values.
  
  table <- table[[2]] %>%
    html_table(fill = TRUE) %>%
    select(-Tot) %>%
    drop_na()
  
  # Used the number of rows to remove the last row of the table (the Totals row)

  cnt = nrow(table)
  
  table <- table[-c(cnt),]
  
  # Removed rows that had all zero values, or no students receiving degrees in a
  # certain field in 2018

  table <- table[!(table$Male==0 & table$Female==0),]

  # Make all columns except the first column numeric 
  
  table[, 2:ncol(table)] = apply(table[, 2:ncol(table)], 2, function(x) as.numeric(x))

  return(table)
}
```

Brown University
```{r brown, echo=FALSE}

# Demographics for Brown Engineering degrees awarded by program in 2018

brown_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8107/screen/21?school_name=Brown+University")

brown_ugrad_degrees_2018 

```

Columbia University
```{r columbia, echo=FALSE}

# Demographics for Columbia Engineering degrees awarded by program in 2018.

columbia_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8224/screen/21?school_name=Columbia+University")

columbia_ugrad_degrees_2018
```

Cornell University
```{r cornell, echo=FALSE}

# Demographics for Cornell Engineering degrees awarded by program in 2018. 

cornell_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8046/screen/21?school_name=Cornell+University")

cornell_ugrad_degrees_2018
```

Dartmouth College
```{r dartmouth, echo=FALSE}

# Demographics for Dartmouth Engineering degrees awarded by program in 2018.

dartmouth_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8085/screen/21?school_name=Dartmouth+College")

dartmouth_ugrad_degrees_2018
```

Harvard University
```{r harvard, echo=FALSE}

# Demographics for Harvard Engineering degrees awarded by program in 2018.

harvard_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8130/screen/21?school_name=Harvard+University")

harvard_ugrad_degrees_2018
```

University of Pennsylvania
```{r penn, echo=FALSE}

# Demographics for UPenn Engineering degrees awarded by program in 2018. 

penn_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8116/screen/21?school_name=University+of+Pennsylvania")

penn_ugrad_degrees_2018
```

Princeton University
```{r princeton, echo=FALSE}

# Demographics for Princeton Engineering degrees awarded by program in 2018. 

princeton_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8068/screen/21?school_name=Princeton+University") 

princeton_ugrad_degrees_2018
```

Yale School of Engineering & Applied Science
```{r yale, echo=FALSE}

# Demographics for Yale Engineering degrees awarded by program in 2018. 

yale_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8218/screen/21?school_name=Yale+School+of+Engineering+%26+Applied+Science") 

yale_ugrad_degrees_2018
```

Boston University
```{r boston, echo=FALSE}

# Demographics for Boston University Engineering degrees awarded by program in 2018. 

boston_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8150/screen/21?school_name=Boston+University")

boston_ugrad_degrees_2018
```

California Institute of Technology
```{r caltech, echo=FALSE}

# Demographics for California Institute of Technology Engineering degrees
# awarded by program in 2018.

caltech_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8089/screen/21?school_name=California+Institute+of+Technology")

caltech_ugrad_degrees_2018 
```

University of California, Berkeley
```{r berkeley, echo=FALSE}

# Demographics for UC Berkeley Engineering degrees awarded by program in 2018.

berkeley_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8005/screen/21?school_name=University+of+California%2C+Berkeley")

berkeley_ugrad_degrees_2018 
```

Carnegie Mellon University
```{r cmu, echo=FALSE}

# Demographics for Carnegie Mellon University Engineering degrees awarded by
# program in 2018.

cmu_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8163/screen/21?school_name=Carnegie+Mellon+University")

cmu_ugrad_degrees_2018 
```

Duke University
```{r duke, echo=FALSE}

# Demographics for Duke Engineering degrees awarded by program in 2018.

duke_ugrad_degrees_2018 <- 
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8113/screen/21?school_name=Duke+University+")

duke_ugrad_degrees_2018
```

Georgia Institute of Technology
```{r gt, echo=FALSE}

# Demographics for Georgia Tech Engineering degrees awarded by program in 2018.

gt_ugrad_degrees_2018 <- 
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8138/screen/21?school_name=Georgia+Institute+of+Technology")

gt_ugrad_degrees_2018
```

Harvey Mudd College
```{r harveymudd, echo=FALSE}

# Demographics for Harvey Mudd College Engineering degrees awarded by program in
# 2018.

mudd_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8242/screen/21?school_name=Harvey+Mudd+College")

mudd_ugrad_degrees_2018
```

Johns Hopkins University
```{r jhu, echo=FALSE}

# Demographics for Johns Hopkins University Engineering degrees awarded by
# program in 2018.

jhu_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8145/screen/21?school_name=The+Johns+Hopkins+University")

jhu_ugrad_degrees_2018
```

Massachusetts Institute of Technology
```{r mit, echo=FALSE}

# Demographics for MIT Engineering degrees awarded by program in 2018.

mit_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8024/screen/21?school_name=Massachusetts+Institute+of+Technology")

mit_ugrad_degrees_2018
```

Northwestern University
```{r northwestern, echo=FALSE}

# Demographics for Northwestern Engineering degrees awarded by program in 2018.

nw_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8194/screen/21?school_name=Northwestern+University")

nw_ugrad_degrees_2018
```

Tufts University
```{r tufts, echo=FALSE}

# Demographics for Tufts Engineering degrees awarded by program in 2018.

tufts_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8000/screen/21?school_name=Tufts+University")

tufts_ugrad_degrees_2018
```

Vanderbilt University
```{r vanderbilt, echo=FALSE}

# Demographics for Vanderbilt Engineering degrees awarded by program in 2018.

vanderbilt_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8048/screen/21?school_name=Vanderbilt+University")

vanderbilt_ugrad_degrees_2018
```

University of Virginia
```{r uva, echo=FALSE}

# Demographics for UVA Engineering degrees awarded by program in 2018.

uva_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8008/screen/21?school_name=University+of+Virginia")

uva_ugrad_degrees_2018
```

Washington University in St. Louis
```{r washu, echo=FALSE}

# Demographics for Washington University in St. Louis Engineering degrees
# awarded by program in 2018.

washu_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8088/screen/21?school_name=Washington+University+in+St.+Louis")

washu_ugrad_degrees_2018
```

## Visualizations (Milestone 5)

```{r race ivy league, echo=FALSE}

# Made a function to get the total number of students of each race from each of
# the tables

race <- function(tibble) {
  tibble %>%
  select(Nra, Unk, His, Ind, Asi, Blk, Pac, Wht, Two) %>%
  mutate(Nra = sum(Nra), Unk = sum(Unk), 
         His = sum(His), Ind = sum(Ind), 
         Asi = sum(Asi), Blk = sum(Blk), 
         Pac = sum(Pac), Wht = sum(Wht), 
         Two = sum(Two)) %>%
  slice(1)
}

# Made a table with all of the Ivy League schools for race

race_ivy_league <- rbind(
  race(brown_ugrad_degrees_2018),
  race(columbia_ugrad_degrees_2018),
  race(cornell_ugrad_degrees_2018),
  race(dartmouth_ugrad_degrees_2018),
  race(harvard_ugrad_degrees_2018),
  race(penn_ugrad_degrees_2018),
  race(princeton_ugrad_degrees_2018),
  race(yale_ugrad_degrees_2018)) %>%
  mutate(school = c("Brown", "Columbia", "Cornell", "Dartmouth",
                    "Harvard", "UPenn", "Princeton", "Yale"))

# Used ggplot() and geom_bar() to plot the Ivy League race data. Had to tidy the
# data using pivot_longer() in order to use ggplot() to plot it. Used
# ColorBrewer to change the colors of the stacked bar chart.

race_ivy_league %>%
  pivot_longer(c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two"), 
               names_to = "race", values_to = "values") %>%
  ggplot(aes(x = school, y = values, fill = race)) + 
    geom_bar(position="stack", stat="identity") +
    labs(title = "Total Students Receiving Engineering Degrees at Ivy League Schools in 2018", 
         x = "Ivy League Schools", y = "Students",
         caption = "Source: American Society for Engineering Education \n 
         Nra - Nonresident aliens, Asi - Asian American, Blk - Black, 
         His - Hispanic, Ind - American Indian, Pac - Pacific Islander, 
         Unk - Unknown, Wht - White, Tot - Program Totals, Two - Two or More") + 
    scale_fill_manual("Race", values = c("Nra" = "#a6cee3", "Unk" = "#1f78b4",
                                         "His" = "#b2df8a", "Ind" = "#33a02c",
                                         "Asi" = "#fb9a99", "Blk" = "#e31a1c",
                                         "Pac" = "#fdbf6f", "Wht" = "#ff7f00",
                                         "Two" = "#cab2d6"),
                      breaks = c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two")) + 
  theme_classic()
```

```{r gender ivy league, echo = FALSE}
# Made a function to get the total number of Male and Female students from each
# of the tables

male_female <- function(tibble) {
  tibble %>%
  select(Male, Female) %>%
  mutate(Male = sum(Male), Female = sum(Female)) %>%
  slice(1)
}

# Made a table with all of the Ivy League schools for gender

gender_ivy_league <- rbind(
  male_female(brown_ugrad_degrees_2018),
  male_female(columbia_ugrad_degrees_2018),
  male_female(cornell_ugrad_degrees_2018),
  male_female(dartmouth_ugrad_degrees_2018),
  male_female(harvard_ugrad_degrees_2018),
  male_female(penn_ugrad_degrees_2018),
  male_female(princeton_ugrad_degrees_2018),
  male_female(yale_ugrad_degrees_2018)) %>%
  mutate(school = c("Brown", "Columbia", "Cornell", "Dartmouth",
                    "Harvard", "UPenn", "Princeton", "Yale"))

# Used ggplot() and geom_bar() to plot the Ivy League race data. Made the data
# tidy using pivot_longer() in order to use ggplot() to plot the data.

gender_ivy_league %>%
  pivot_longer(c("Male", "Female"), names_to = "gender", values_to = "values") %>%
  ggplot(aes(x = school, y = values, fill = gender)) + 
    geom_bar(position="dodge", stat="identity") +
    labs(title = "Total Students Receiving Engineering Degrees at Ivy League Schools in 2018", 
         x = "Ivy League Schools", y = "Students", 
         caption = "Source: American Society for Engineering Education") + 
    scale_fill_discrete(name = "Gender") +
  theme_classic()
```



























