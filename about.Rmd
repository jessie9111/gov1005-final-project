---
title: "About"
author: "Jessica Edwards"
date: "2/27/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(janitor)
```

## Summary and Goals

This project's goal is to analyze students studying STEM at the university level and to break down and compare racial and gender demographics between highly ranked institutions within the United States. This data is collected from the [American Society for Engineering Education (ASEE)](https://www.asee.org/). 

This investigation hopes to critique the current demographic breakdown of STEM fields and encourage higher institutions to think more about how they can help encourage underrepresented minorities to enter and remain interested in STEM fields. 

So far in my project, I have currently found and cleaned data tables on Degrees Awarded by Program in 2018. These tables provide the racial and gender breakdowns within STEM degrees awarded at each school. 

I would also like to analyze the number of students studying each field in total over a longer time span to see if the racial and gender breakdowns changes significantly over time. 

Additionally, there are tables on the ASEE website that break down each field based on how many students identify as male or female within each race which may be interesting to incorporate in my project. 

Finally, I may consider including data about K-12 STEM programs and career paths in my project in order to analyze if racial and gender breakdowns before and after college are similar.

#### Github Link: https://github.com/jessie9111/gov1005-final-project

## The Data

```{r ugrad_degrees function, echo=FALSE}

# Wrote a function to scrap all of the tables more efficiently. Function takes
# in a url and scrapes that page for tables using function in the rvest package.

ugrad_degrees_2018 <- function(url) {
  table <- read_html(url) %>% 
    html_nodes("table")

  # Used the rvest package to read the table with racial and gender breakdowns.
  # Removed the "Tot" column in the table and rows with NA values.
  
  table <- table[[2]] %>%
    html_table(fill = TRUE) %>%
    select(-Tot) %>%
    drop_na()
  
  # Used the number of rows to remove the last row of the table (the Totals row)

  cnt = nrow(table)
  
  table <- table[-c(cnt),]
  
  # Removed rows that had all zero values, or no students receiving degrees in a
  # certain field in 2018

  table <- table[!(table$Male==0 & table$Female==0),]

  # Make all columns except the first column numeric 
  
  table[, 2:ncol(table)] = apply(table[, 2:ncol(table)], 2, function(x) as.numeric(x))

  return(table)
}
```

Brown University
```{r brown, echo=FALSE}

# Demographics for Brown Engineering degrees awarded by program in 2018

brown_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8107/screen/21?school_name=Brown+University")

```

Columbia University
```{r columbia, echo=FALSE}

# Demographics for Columbia Engineering degrees awarded by program in 2018.

columbia_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8224/screen/21?school_name=Columbia+University")
```

Cornell University
```{r cornell, echo=FALSE}

# Demographics for Cornell Engineering degrees awarded by program in 2018. 

cornell_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8046/screen/21?school_name=Cornell+University")

```

Dartmouth College
```{r dartmouth, echo=FALSE}

# Demographics for Dartmouth Engineering degrees awarded by program in 2018.

dartmouth_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8085/screen/21?school_name=Dartmouth+College")

```

Harvard University
```{r harvard, echo=FALSE}

# Demographics for Harvard Engineering degrees awarded by program in 2018.

harvard_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8130/screen/21?school_name=Harvard+University")


```

University of Pennsylvania
```{r penn, echo=FALSE}

# Demographics for UPenn Engineering degrees awarded by program in 2018. 

penn_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8116/screen/21?school_name=University+of+Pennsylvania")


```

Princeton University
```{r princeton, echo=FALSE}

# Demographics for Princeton Engineering degrees awarded by program in 2018. 

princeton_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8068/screen/21?school_name=Princeton+University") 

```

Yale School of Engineering & Applied Science
```{r yale, echo=FALSE}

# Demographics for Yale Engineering degrees awarded by program in 2018. 

yale_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8218/screen/21?school_name=Yale+School+of+Engineering+%26+Applied+Science") 

```

Boston University
```{r boston, echo=FALSE}

# Demographics for Boston University Engineering degrees awarded by program in 2018. 

boston_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8150/screen/21?school_name=Boston+University")

```

California Institute of Technology
```{r caltech, echo=FALSE}

# Demographics for California Institute of Technology Engineering degrees
# awarded by program in 2018.

caltech_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8089/screen/21?school_name=California+Institute+of+Technology")


 
```

University of California, Berkeley
```{r berkeley, echo=FALSE}

# Demographics for UC Berkeley Engineering degrees awarded by program in 2018.

berkeley_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8005/screen/21?school_name=University+of+California%2C+Berkeley")

```

Carnegie Mellon University
```{r cmu, echo=FALSE}

# Demographics for Carnegie Mellon University Engineering degrees awarded by
# program in 2018.

cmu_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8163/screen/21?school_name=Carnegie+Mellon+University")

```

Duke University
```{r duke, echo=FALSE}

# Demographics for Duke Engineering degrees awarded by program in 2018.

duke_ugrad_degrees_2018 <- 
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8113/screen/21?school_name=Duke+University+")


```

Georgia Institute of Technology
```{r gt, echo=FALSE}

# Demographics for Georgia Tech Engineering degrees awarded by program in 2018.

gt_ugrad_degrees_2018 <- 
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8138/screen/21?school_name=Georgia+Institute+of+Technology")


```

Harvey Mudd College
```{r harveymudd, echo=FALSE}

# Demographics for Harvey Mudd College Engineering degrees awarded by program in
# 2018.

mudd_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8242/screen/21?school_name=Harvey+Mudd+College")

```

Johns Hopkins University
```{r jhu, echo=FALSE}

# Demographics for Johns Hopkins University Engineering degrees awarded by
# program in 2018.

jhu_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8145/screen/21?school_name=The+Johns+Hopkins+University")


```

Massachusetts Institute of Technology
```{r mit, echo=FALSE}

# Demographics for MIT Engineering degrees awarded by program in 2018.

mit_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8024/screen/21?school_name=Massachusetts+Institute+of+Technology")


```

Northwestern University
```{r northwestern, echo=FALSE}

# Demographics for Northwestern Engineering degrees awarded by program in 2018.

nw_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8194/screen/21?school_name=Northwestern+University")

```

Tufts University
```{r tufts, echo=FALSE}

# Demographics for Tufts Engineering degrees awarded by program in 2018.

tufts_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8000/screen/21?school_name=Tufts+University")

```

Vanderbilt University
```{r vanderbilt, echo=FALSE}

# Demographics for Vanderbilt Engineering degrees awarded by program in 2018.

vanderbilt_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8048/screen/21?school_name=Vanderbilt+University")


```

University of Virginia
```{r uva, echo=FALSE}

# Demographics for UVA Engineering degrees awarded by program in 2018.

uva_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8008/screen/21?school_name=University+of+Virginia")

```

Washington University in St. Louis
```{r washu, echo=FALSE}

# Demographics for Washington University in St. Louis Engineering degrees
# awarded by program in 2018.

washu_ugrad_degrees_2018 <-
  ugrad_degrees_2018("http://profiles.asee.org/profiles/8088/screen/21?school_name=Washington+University+in+St.+Louis")

```

## Visualizations

```{r race ivy league, echo=FALSE}

# Made a function to get the total number of students of each race from each of
# the tables

race <- function(tibble) {
  tibble %>%
  select(Nra, Unk, His, Ind, Asi, Blk, Pac, Wht, Two) %>%
  mutate(Nra = sum(Nra), Unk = sum(Unk), 
         His = sum(His), Ind = sum(Ind), 
         Asi = sum(Asi), Blk = sum(Blk), 
         Pac = sum(Pac), Wht = sum(Wht), 
         Two = sum(Two), 
         Total = Nra + Unk + His + Ind + Asi + Blk + Pac + Wht + Two) %>%
  slice(1)
}

# Made a table with all of the schools for race

race_ivy_league <- rbind(
  race(brown_ugrad_degrees_2018),
  race(columbia_ugrad_degrees_2018),
  race(cornell_ugrad_degrees_2018),
  race(dartmouth_ugrad_degrees_2018),
  race(harvard_ugrad_degrees_2018),
  race(penn_ugrad_degrees_2018),
  race(princeton_ugrad_degrees_2018),
  race(yale_ugrad_degrees_2018)) %>%
  mutate(school = c("Brown", "Columbia", "Cornell", "Dartmouth",
                    "Harvard", "UPenn", "Princeton", "Yale")) %>%
  pivot_longer(c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two"), 
               names_to = "race", values_to = "values") %>%
  mutate(perc = (values / Total) * 100)

race_all_schools <- rbind (
  race(brown_ugrad_degrees_2018),
  race(columbia_ugrad_degrees_2018),
  race(cornell_ugrad_degrees_2018),
  race(dartmouth_ugrad_degrees_2018),
  race(harvard_ugrad_degrees_2018),
  race(penn_ugrad_degrees_2018),
  race(princeton_ugrad_degrees_2018),
  race(yale_ugrad_degrees_2018),
  race(boston_ugrad_degrees_2018),
  race(caltech_ugrad_degrees_2018), 
  race(berkeley_ugrad_degrees_2018), 
  race(cmu_ugrad_degrees_2018), 
  race(duke_ugrad_degrees_2018),
  race(gt_ugrad_degrees_2018),
  race(mudd_ugrad_degrees_2018),
  race(jhu_ugrad_degrees_2018),
  race(mit_ugrad_degrees_2018),
  race(nw_ugrad_degrees_2018),
  race(tufts_ugrad_degrees_2018),
  race(vanderbilt_ugrad_degrees_2018),
  race(uva_ugrad_degrees_2018),
  race(washu_ugrad_degrees_2018)) %>%
  mutate(school = c("Brown", "Columbia", "Cornell", "Dartmouth",
                    "Harvard", "UPenn", "Princeton", "Yale", 
                    "Boston University", "CalTech", "UC Berkeley", 
                    "Carnegie Mellon", "Duke", "Georgia Tech", 
                    "Harvey Mudd", "Johns Hopkins", "MIT", "Northwestern", 
                    "Tufts", "Vanderbilt", "University of Virginia", 
                    "Washington University in St. Louis")) %>%
  pivot_longer(c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two"), 
               names_to = "race", values_to = "values") %>%
  mutate(perc = (values / Total) * 100)

# Used ggplot() and geom_bar() to plot the race data. Had to tidy the
# data using pivot_longer() in order to use ggplot() to plot it. Used
# ColorBrewer to change the colors of the stacked bar chart.

race_ivy_league %>%
  ggplot(aes(x = reorder(school, -values), y = values, fill = race)) + 
    geom_bar(position="stack", stat="identity") +
    labs(title = "Total Students Receiving Engineering Degrees at Ivy League Schools in 2018", 
         x = "Ivy League Schools", y = "Total Degree Earning Students",
         caption = "Source: American Society for Engineering Education \n 
         Nra - Nonresident aliens, Asi - Asian American, Blk - Black, 
         His - Hispanic, Ind - American Indian, Pac - Pacific Islander, 
         Unk - Unknown, Wht - White, Tot - Program Totals, Two - Two or More") + 
    scale_fill_manual("Race", values = c("Nra" = "#a6cee3", "Unk" = "#1f78b4",
                                         "His" = "#b2df8a", "Ind" = "#33a02c",
                                         "Asi" = "#fb9a99", "Blk" = "#e31a1c",
                                         "Pac" = "#fdbf6f", "Wht" = "#ff7f00",
                                         "Two" = "#cab2d6"),
                      breaks = c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two")) + 
  theme_classic()

# race_all_schools %>%
#   ggplot(aes(x = reorder(school, values), y = values, fill = race)) + 
#     geom_bar(position="stack", stat="identity") +
#     labs(title = "Total Students Receiving Engineering Degrees 
#     at Highly Ranked Institutions in 2018", 
#          x = "Schools", y = "Total Degree Earning Students",
#          caption = "Source: American Society for Engineering Education \n 
#          Nra - Nonresident aliens, Asi - Asian American, Blk - Black, 
#          His - Hispanic, Ind - American Indian, Pac - Pacific Islander, 
#          Unk - Unknown, Wht - White, Tot - Program Totals, Two - Two or More") + 
#     scale_fill_manual("Race", values = c("Nra" = "#a6cee3", "Unk" = "#1f78b4",
#                                          "His" = "#b2df8a", "Ind" = "#33a02c",
#                                          "Asi" = "#fb9a99", "Blk" = "#e31a1c",
#                                          "Pac" = "#fdbf6f", "Wht" = "#ff7f00",
#                                          "Two" = "#cab2d6"),
#                       breaks = c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two")) + 
#   theme_classic() + coord_flip()

race_all_schools %>%
  ggplot(aes(x = reorder(school, values), y = perc, fill = race)) + 
    geom_bar(position="stack", stat="identity") +
    labs(title = "Percentage of Students Receiving Engineering Degrees \nby Race at Highly Ranked Institutions in 2018", subtitle = "Schools Ranked in Descending Order by Engineering School Size",
         x = "Schools", y = "Percent of Degree Earning Students",
         caption = "Source: American Society for Engineering Education \n 
         Nra - Nonresident aliens, Asi - Asian American, Blk - Black, 
         His - Hispanic, Ind - American Indian, Pac - Pacific Islander, 
         Unk - Unknown, Wht - White, Tot - Program Totals, Two - Two or More") + 
    scale_fill_manual("Race", values = c("Nra" = "#a6cee3", "Unk" = "#1f78b4",
                                         "His" = "#b2df8a", "Ind" = "#33a02c",
                                         "Asi" = "#fb9a99", "Blk" = "#e31a1c",
                                         "Pac" = "#fdbf6f", "Wht" = "#ff7f00",
                                         "Two" = "#cab2d6"),
                      breaks = c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two")) + 
  theme_classic() + coord_flip()

```

```{r gender ivy league, echo = FALSE}
# Made a function to get the total number of Male and Female students from each
# of the tables

male_female <- function(tibble) {
  tibble %>%
  select(Male, Female) %>%
  mutate(Male = sum(Male), Female = sum(Female), Total = Male + Female) %>%
  slice(1)
}

# Made a table with all of the schools for gender

gender_ivy_league <- rbind(
  male_female(brown_ugrad_degrees_2018),
  male_female(columbia_ugrad_degrees_2018),
  male_female(cornell_ugrad_degrees_2018),
  male_female(dartmouth_ugrad_degrees_2018),
  male_female(harvard_ugrad_degrees_2018),
  male_female(penn_ugrad_degrees_2018),
  male_female(princeton_ugrad_degrees_2018),
  male_female(yale_ugrad_degrees_2018)) %>%
  mutate(school = c("Brown", "Columbia", "Cornell", "Dartmouth",
                    "Harvard", "UPenn", "Princeton", "Yale")) %>%
  pivot_longer(c("Male", "Female"), names_to = "gender", values_to = "values") %>%
  mutate(perc = (values/Total) * 100)

gender_all_schools <- rbind (
  male_female(brown_ugrad_degrees_2018),
  male_female(columbia_ugrad_degrees_2018),
  male_female(cornell_ugrad_degrees_2018),
  male_female(dartmouth_ugrad_degrees_2018),
  male_female(harvard_ugrad_degrees_2018),
  male_female(penn_ugrad_degrees_2018),
  male_female(princeton_ugrad_degrees_2018),
  male_female(yale_ugrad_degrees_2018),
  male_female(boston_ugrad_degrees_2018),
  male_female(caltech_ugrad_degrees_2018), 
  male_female(berkeley_ugrad_degrees_2018), 
  male_female(cmu_ugrad_degrees_2018), 
  male_female(duke_ugrad_degrees_2018),
  male_female(gt_ugrad_degrees_2018),
  male_female(mudd_ugrad_degrees_2018),
  male_female(jhu_ugrad_degrees_2018),
  male_female(mit_ugrad_degrees_2018),
  male_female(nw_ugrad_degrees_2018),
  male_female(tufts_ugrad_degrees_2018),
  male_female(vanderbilt_ugrad_degrees_2018),
  male_female(uva_ugrad_degrees_2018),
  male_female(washu_ugrad_degrees_2018)) %>%
  mutate(school = c("Brown", "Columbia", "Cornell", "Dartmouth",
                    "Harvard", "UPenn", "Princeton", "Yale", 
                    "Boston University", "CalTech", "UC Berkeley", 
                    "Carnegie Mellon", "Duke", "Georgia Tech", 
                    "Harvey Mudd", "Johns Hopkins", "MIT", "Northwestern", 
                    "Tufts", "Vanderbilt", "University of Virginia", 
                    "Washington University in St. Louis")) %>%
  pivot_longer(c("Male", "Female"), names_to = "gender", values_to = "values") %>%
  mutate(perc = (values/Total) * 100)

# Used ggplot() and geom_bar() to plot the gender data. Made the data
# tidy using pivot_longer() in order to use ggplot() to plot the data.

gender_ivy_league %>%
  ggplot(aes(x = reorder(school, -values), y = values, fill = gender)) + 
    geom_bar(position="dodge", stat="identity") +
    labs(title = "Total Students Receiving Engineering Degrees at Ivy League Schools in 2018", 
         x = "Ivy League Schools", y = "Total Degree Earning Students", 
         caption = "Source: American Society for Engineering Education") + 
    scale_fill_discrete(name = "Gender") +
  theme_classic()

# gender_all_schools %>%
#   ggplot(aes(x = reorder(school, values), y = values, fill = gender)) + 
#     geom_bar(position="dodge", stat="identity") +
#     labs(title = "Total Students Receiving Engineering Degrees
#     at Highly Ranked Institutions in 2018", 
#          x = "Schools", y = "Total Degree Earning Students", 
#          caption = "Source: American Society for Engineering Education") + 
#     scale_fill_discrete(name = "Gender") +
#   theme_classic() + coord_flip()

gender_all_schools %>%
  ggplot(aes(x = reorder(school, values), y = perc, fill = gender)) +
    geom_bar(position="stack", stat="identity") +
    labs(title = "Percentage of Students Receiving Engineering Degrees \nby Gender at Highly Ranked Institutions in 2018", subtitle = "Schools Ranked in Descending Order by Engineering School Size",
         x = "Schools", y = "Percent of Degree Earning Students",
         caption = "Source: American Society for Engineering Education") +
    scale_fill_discrete(name = "Gender") +
  theme_classic() + coord_flip()
```

```{r harvard plot, echo = FALSE}
# harvard_ugrad_degrees_2018

tables <- read_html("http://profiles.asee.org/profiles/7332/screen/20?school_name=Harvard+University") %>% 
  html_nodes("table") 

harvard_soph_2016 <- tables[[3]] %>% 
  html_table(fill = TRUE) 

harvard_soph_2016 <- harvard_soph_2016[-c(1, 32),] 

harvard_soph_2016 <- harvard_soph_2016[ , colSums(is.na(harvard_soph_2016)) == 0]

harvard_soph_2016 <- harvard_soph_2016 %>%
  select(-ends_with("1"), -Total) %>%
  mutate(major = c(rep("Applied Mathematics (A.B.)", 3),
                   rep("Biomedical Engineering (A.B.)", 3),
                   rep("Biomedical Engineering (S.B.)", 3),
                   rep("Computer Science (A.B.)", 3),
                   rep("Electrical Engineering (A.B)", 3),
                   rep("Electrical Engineering (S.B.)", 3),
                   rep("Engineering Sciences (A.B.)", 3),
                   rep("Engineering Sciences (S.B.)", 3),
                   rep("Mechanical Engineering (A.B)", 3),
                   rep("Mechanical Engineering (S.B.)", 3))) %>%
  rename(gender = Group,
         Nra = `Nonresident Alien`,
         Unk = Unknown,
         His = Hispanic,
         Ind = `American Indian`,
         Asi = Asian,
         Blk = Black,
         Pac = `Pacific Islander`,
         Wht = `White`,
         Two = `Two or More`)

harvard_soph_2016 <- harvard_soph_2016[-c(1, 4, 7, 10, 13, 16, 19, 22, 25, 28),] 

harvard_soph_2016 <- harvard_soph_2016 %>%
  mutate(gender = ifelse(gender == "Men", "Male", "Female")) %>%
  pivot_longer(c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two"), 
               names_to = "race", values_to = "students") %>%
  mutate(students = as.numeric(students))

gender_2016 <- harvard_soph_2016 %>%
  group_by(gender, major) %>%
  summarize(students = sum(students))

race_2016 <- harvard_soph_2016 %>%
  group_by(race, major) %>%
  summarize(students = sum(students))

gender_2018 <- harvard_ugrad_degrees_2018 %>%
  select(`Bachelor's Degree Program(s)`, Male, Female) %>%
  rename(major = `Bachelor's Degree Program(s)`) %>%
  pivot_longer(c("Male", "Female"), names_to = "gender", values_to = "students") %>%
  mutate(major = case_when(
    major == "Engineering Sciences - Bioengineering (S.B.)" ~ "Engineering Sciences (S.B.)",
    major == "Engineering Sciences - Environmental Science and Engineering (S.B.)" 
    ~ "Engineering Sciences (S.B.)",
    major == "Engineering Sciences - Electrical and Computer Engineering (A.B.)" 
    ~ "Engineering Sciences (A.B.)",
    major == "Engineering Sciences - Mechanical and Materials Science and Engineering (A.B.)" ~ "Engineering Sciences (A.B.)",
    major == "Engineering Sciences - Environmental Science and Engineering (A.B.)" ~ 
    "Engineering Sciences (A.B.)",
    major == "Engineering Sciences - Biomedical Sciences and Engineering (A.B.)" ~ 
    "Engineering Sciences (A.B.)",
    TRUE ~ major
  ))

race_2018 <- harvard_ugrad_degrees_2018 %>%
  select(-Male, -Female) %>%
  rename(major = `Bachelor's Degree Program(s)`) %>%
  pivot_longer(c("Nra", "Unk", "His", "Ind", "Asi", "Blk", "Pac", "Wht", "Two"), 
               names_to = "race", values_to = "students") %>%
  mutate(major = case_when(
    major == "Engineering Sciences - Bioengineering (S.B.)" ~ "Engineering Sciences (S.B.)",
    major == "Engineering Sciences - Environmental Science and Engineering (S.B.)" 
    ~ "Engineering Sciences (S.B.)",
    major == "Engineering Sciences - Electrical and Computer Engineering (A.B.)" 
    ~ "Engineering Sciences (A.B.)",
    major == "Engineering Sciences - Mechanical and Materials Science and Engineering (A.B.)" ~ "Engineering Sciences (A.B.)",
    major == "Engineering Sciences - Environmental Science and Engineering (A.B.)" ~ 
    "Engineering Sciences (A.B.)",
    major == "Engineering Sciences - Biomedical Sciences and Engineering (A.B.)" ~ 
    "Engineering Sciences (A.B.)",
    TRUE ~ major
  ))
```

```{r race retention, echo = FALSE}

blk_2016 <- race_2016 %>%
  filter(race == "Blk") %>%
  group_by(major) %>%
  summarize(students_2016 = sum(students)) %>%
  filter(students_2016 != 0)

blk_2018 <- race_2018 %>%
  filter(race == "Blk") %>%
  group_by(major) %>%
  summarize(students_2018 = sum(students))

blk_2016_2018 <- blk_2016 %>%
  left_join(blk_2018, by = "major") %>%
  pivot_longer(students_2016:students_2018, names_to = "year", names_prefix = "students_", values_to = "students")

blk_2016_2018 %>%
  ggplot(aes(x = reorder(major, students), y = students, fill = year)) + 
    geom_bar(position=position_dodge2(reverse = TRUE), stat="identity") +
    labs(title = "Black Sophomores in SEAS in 2016 Compared to \nStudents Receiving Degrees in 2018",
         subtitle = "Retention of Harvard SEAS Black Undergrads \nfrom 2016 to 2018",
         x = "Major", y = "Students") + 
    theme_classic() + coord_flip() +
    scale_fill_discrete(name = "Year")

his_2016 <- race_2016 %>%
  filter(race == "His") %>%
  group_by(major) %>%
  summarize(students_2016 = sum(students)) %>%
  filter(students_2016 != 0)

his_2018 <- race_2018 %>%
  filter(race == "His") %>%
  group_by(major) %>%
  summarize(students_2018 = sum(students))

his_2016_2018 <- his_2016 %>%
  left_join(his_2018, by = "major") %>%
  pivot_longer(students_2016:students_2018, names_to = "year", names_prefix = "students_", values_to = "students")

his_2016_2018 %>%
  ggplot(aes(x = reorder(major, students), y = students, fill = year)) + 
    geom_bar(position=position_dodge2(reverse = TRUE), stat="identity") +
    labs(title = "Hispanic Sophomores in SEAS in 2016 Compared to \nStudents Receiving Degrees in 2018",
         subtitle = "Retention of Harvard SEAS Hispanic Undergrads \nfrom 2016 to 2018",
         x = "Major", y = "Students") + 
    theme_classic() + coord_flip() +
    scale_fill_discrete(name = "Year")

wht_2016 <- race_2016 %>%
  filter(race == "Wht") %>%
  group_by(major) %>%
  summarize(students_2016 = sum(students)) %>%
  filter(students_2016 != 0)

wht_2018 <- race_2018 %>%
  filter(race == "Wht") %>%
  group_by(major) %>%
  summarize(students_2018 = sum(students))

wht_2016_2018 <- wht_2016 %>%
  left_join(wht_2018, by = "major") %>%
  pivot_longer(students_2016:students_2018, names_to = "year", names_prefix = "students_", values_to = "students")

wht_2016_2018 %>%
  ggplot(aes(x = reorder(major, students), y = students, fill = year)) + 
    geom_bar(position=position_dodge2(reverse = TRUE), stat="identity") +
    labs(title = "White Sophomores in SEAS in 2016 Compared to \nStudents Receiving Degrees in 2018",
         subtitle = "Retention of Harvard SEAS White Undergrads \nfrom 2016 to 2018",
         x = "Major", y = "Students") + 
    theme_classic() + coord_flip() +
    scale_fill_discrete(name = "Year")

asi_2016 <- race_2016 %>%
  filter(race == "Asi") %>%
  group_by(major) %>%
  summarize(students_2016 = sum(students)) %>%
  filter(students_2016 != 0)

asi_2018 <- race_2018 %>%
  filter(race == "Asi") %>%
  group_by(major) %>%
  summarize(students_2018 = sum(students))

asi_2016_2018 <- asi_2016 %>%
  left_join(asi_2018, by = "major") %>%
  pivot_longer(students_2016:students_2018, names_to = "year", names_prefix = "students_", values_to = "students")

asi_2016_2018 %>%
  ggplot(aes(x = reorder(major, students), y = students, fill = year)) + 
    geom_bar(position=position_dodge2(reverse = TRUE), stat="identity") +
    labs(title = "Asian Sophomores in SEAS in 2016 Compared to \nStudents Receiving Degrees in 2018",
         subtitle = "Retention of Harvard SEAS Asian Undergrads \nfrom 2016 to 2018",
         x = "Major", y = "Students") + 
    theme_classic() + coord_flip() +
    scale_fill_discrete(name = "Year")
```

```{r gender retention, echo = FALSE}

female_2016 <- gender_2016 %>%
  filter(gender == "Female" & students != 0) %>%
  group_by(major, gender) %>%
  summarize(students_2016 = sum(students))

female_2018 <- gender_2018 %>%
  filter(gender == "Female") %>%
  group_by(major, gender) %>%
  summarize(students_2018 = sum(students))

female_2016_2018 <- female_2016 %>%
  left_join(female_2018, by = c("major", "gender")) %>%
  select(major, students_2016, students_2018) %>%
  pivot_longer(students_2016:students_2018, names_to = "year", names_prefix = "students_", values_to = "students")

female_2016_2018 %>%
  ggplot(aes(x = reorder(major, students), y = students, fill = year)) + 
    geom_bar(position=position_dodge2(reverse = TRUE), stat="identity") +
    labs(title = "Female Sophmores in SEAS in 2016 Compared to \nSeniors Receiving Degrees from SEAS in 2018",
         subtitle = "Retention of Harvard SEAS Female Undergrads \nfrom 2016 to 2018",
         x = "Major", y = "Students") + 
    theme_classic() + coord_flip() +
    scale_fill_discrete(name = "Year")

male_2016 <- gender_2016 %>%
  filter(gender == "Male" & students != 0) %>%
  group_by(major, gender) %>%
  summarize(students_2016 = sum(students))

male_2018 <- gender_2018 %>%
  filter(gender == "Male") %>%
  group_by(major, gender) %>%
  summarize(students_2018 = sum(students))

male_2016_2018 <- male_2016 %>%
  left_join(male_2018, by = c("major", "gender")) %>%
  select(major, students_2016, students_2018) %>%
  pivot_longer(students_2016:students_2018, names_to = "year", names_prefix = "students_", values_to = "students")

male_2016_2018 %>%
  ggplot(aes(x = reorder(major, students), y = students, fill = year)) + 
    geom_bar(position=position_dodge2(reverse = TRUE), stat="identity") +
    labs(title = "Male Sophmores in SEAS in 2016 Compared to \nSeniors Receiving Degrees from SEAS in 2018",
         subtitle = "Retention of Harvard SEAS Male Undergrads \nfrom 2016 to 2018",
         x = "Major", y = "Students") + 
    theme_classic() + coord_flip() +
    scale_fill_discrete(name = "Year")

```
```{r model}

# Is a higher percentage of underrepresented minority students (Black and Hispanic) at a school
# associated with more students graduating with engineering degrees in total?

blk_his <- race_all_schools %>%
  filter((perc != 0) & (race == "Blk" | race == "His")) %>%
  group_by(school) %>%
  summarize(total = mean(Total), perc = sum(perc)) 

lm(total ~ perc, blk_his)
ggplot(blk_his, aes(x = perc, y = total)) + geom_point() + theme_classic() + geom_smooth(method = "lm")

# Is a higher percentage of female students at a school associated with more
# students graduating with engineering degrees in total?

fem <- gender_all_schools %>%
  filter(gender == "Female")

lm(Total ~ perc, fem)
ggplot(fem, aes(x = perc, y = Total)) + geom_point() + theme_classic() + geom_smooth(method = "lm")


```

























